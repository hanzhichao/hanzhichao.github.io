	<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Python+Requests接口测试框架 | 韩志超</title>
  <meta name="author" content="Han Zhichao">
  
  <meta name="description" content="测试开发">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Python+Requests接口测试框架"/>
  <meta property="og:site_name" content="韩志超"/>

  
  
		<!-- favicon -->
		<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
		<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.png">
		<meta name="theme-color" content="#009688">
		<!-- favicon end -->
    <!-- <link href="/favicon.ico" rel="icon"> -->
  

  <!-- toc -->
  <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css">

  <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">

  <!-- material design -->
	<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css">
  <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
	<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  

  

  <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/libs/jquery-2.0.3.min.js" type="text/javascript"><\/script>')</script>

</head>

 	<body>
	  <nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">菜单</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">韩志超</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    <a href="/" title="">
                    <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                <li>
                    <a href="/archives" title="">
                    <i class=""></i>存档
                    </a>
                </li>
                
                <li>
                    <a href="/categories" title="">
                    <i class="fa fa-list"></i>分类
                    </a>
                </li>
                
                <li>
                    <a href="/about" title="">
                    <i class="fa fa-info-circle"></i>关于
                    </a>
                </li>
                
                <li>
                    <a href="/atom.xml" title="这是一个订阅源">
                    <i class="fa fa-rss"></i>RSS
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

	  <div class="container" >
	    <div class="row">
	
	<div class="col-md-9">
	

		<div class="content">
			<!-- index -->
		   

			  		<h2>Python+Requests接口测试框架</h2>
					
					<div>
						<span class="post-time">2018-02-01 19:35:29</span>
					</div>	
					

					<div class="article-content">
						<p>#Util/util.py</p>
<h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="coding=utf-8"></a>coding=utf-8</h1><p>import md5 as _md5<br>from data_file_parser import *</p>
<h1 id="对密码进行md5加密"><a href="#对密码进行md5加密" class="headerlink" title="对密码进行md5加密"></a>对密码进行md5加密</h1><p>def md5(password):<br>    m = _md5.new()<br>    m.update(password)<br>    return m.hexdigest()</p>
<h1 id="从配置文件env-conf中读取环境信息，返回字典"><a href="#从配置文件env-conf中读取环境信息，返回字典" class="headerlink" title="从配置文件env.conf中读取环境信息，返回字典"></a>从配置文件env.conf中读取环境信息，返回字典</h1><p>def get_env(section):<br>    return ConfFile.load(“../Conf/env.conf”,section)</p>
<h1 id="从配置文件env-conf中读取base-url信息，返回字符串"><a href="#从配置文件env-conf中读取base-url信息，返回字符串" class="headerlink" title="从配置文件env.conf中读取base_url信息，返回字符串"></a>从配置文件env.conf中读取base_url信息，返回字符串</h1><p>def get_env_url(section):<br>    return ConfFile.get(“../Conf/env.conf”,section,”base_url”)</p>
<h1 id="从配置文件user-conf读取user信息，返回字典"><a href="#从配置文件user-conf读取user信息，返回字典" class="headerlink" title="从配置文件user.conf读取user信息，返回字典"></a>从配置文件user.conf读取user信息，返回字典</h1><p>def get_user(section):<br>    return ConfFile.load(“../Conf/user.conf”,section)<br>def get_api(file_name):<br>    if ‘.json’ not in file_name:<br>        file_name += “.json”<br>    return JsonFile.load(“../API/“+file_name)<br>if <strong>name</strong> == ‘<strong>main</strong>‘:<br>        print get_api(“login.json”)</p>
<p>#Util/data_file_parser.py<br>import json<br>import ConfigParser<br>import xlrd<br>class JsonFile:<br>    def <strong>init</strong>(self):<br>        pass<br>    @classmethod<br>    def get(cls, path, key):<br>        with open(path) as f:<br>            return json.load(f)[key]<br>    @classmethod<br>    def load(cls, path):<br>        with open(path) as f:<br>            return json.load(f)<br>class ConfFile:<br>    def <strong>init</strong>(self):<br>        pass<br>    @classmethod<br>    def get(cls, path, section, option):<br>        conf = ConfigParser.ConfigParser()<br>        conf.read(path)<br>        return conf.get(section, option)<br>    @classmethod<br>    def load(cls, path):<br>        _dict = {}<br>        conf = ConfigParser.ConfigParser()<br>        conf.read(path)<br>        for section in conf.sections():<br>            _dict[section] = {}<br>            for option in conf.options(section):<br>                _dict[section][option] = conf.get(section, option)<br>        return _dict<br>    @classmethod<br>    def load(cls, path, section):<br>        _dict = {}<br>        conf = ConfigParser.ConfigParser()<br>        conf.read(path)<br>        for option in conf.options(section):<br>            _dict[option] = conf.get(section, option)<br>        return _dict<br>class ExcelFile:<br>    def <strong>init</strong>(self):<br>        pass<br>    @classmethod<br>    def get(cls, path, sheet, row, col):<br>        wb = xlrd.open_workbook(path)<br>        if isinstance(sheet, int):<br>            sh = wb.sheet_by_index(sheet)<br>        else:<br>            sh = wb.sheet_by_name(sheet)<br>        return sh.cell_value(row, col)<br>    @classmethod<br>    def load(cls, path, sheet=0):<br>        wb = xlrd.open_workbook(path)<br>        if isinstance(sheet, int):<br>            sh = wb.sheet_by_index(sheet)<br>        else:<br>            sh = wb.sheet_by_name(sheet)<br>        cols = sh.ncols<br>        rows = sh.nrows<br>        data_list = []<br>        for row in range(1, rows):<br>            data = {}<br>            for col in range(0, cols):<br>                data[sh.cell_value(0, col)] = sh.cell_value(row, col)<br>            data_list.append(data)<br>        return data_list<br>class XMLFile:<br>    def <strong>init</strong>(self):<br>        pass<br>    @classmethod<br>    def get(cls):<br>        pass<br>if <strong>name</strong> == ‘<strong>main</strong>‘:<br>    a=A<br>    a.test()</p>
<h1 id="Util-db-py"><a href="#Util-db-py" class="headerlink" title="Util/db.py"></a>Util/db.py</h1><p>#Util/models.py</p>
<h1 id="coding-utf-8-1"><a href="#coding-utf-8-1" class="headerlink" title="coding=utf-8"></a>coding=utf-8</h1><p>from util import <em><br>import json<br>import requests<br>import sys<br>reload(sys)<br>sys.setdefaultencoding(“utf8”)<br>class User:<br>    ‘’’用户对象，初始化时，支持：<br>    0参：读取user.conf中的default选项下的用户；<br>    1参：读取user.conf中的参数对应的选项下的用户<br>    3参：按group_id,user_name,password,顺序读取参数<br>    字典类型参数：按{“group_id”:”**</em>“,”user_name”:”<strong><em>“,”password”:”</em></strong>“}<br>    注：配置文件中或所传password值使用原密码即可，不需要进行md5处理<br>    ‘’’<br>    session = requests.Session()<br>    headers = {‘Content-Type’: ‘application/x-www-form-urlencoded; charset=UTF-8’}<br>    base_url = get_env_url(“default”)<br>    def <strong>init</strong>(self, <em>args, *</em>kws):<br>        self.user_dict = {}</p>
<pre><code>    # 0参，读取配置文件user.conf中的default用户
    if not args or kws:
        self.user_dict = get_user(&apos;default&apos;)
    elif args:
        # 1参：读取user.conf中的参数对应的选项下的用户
        if len(args) == 1:
            self.req = get_user(args[0])
        # 3参：按group_id,user_name,password,顺序读取参数
        elif len(args) == 3:
            self.user_dict[&apos;group_id&apos;] = args[0]
            self.user_dict[&apos;user_name&apos;] = args[1].decode(&apos;utf-8&apos;)
            self.user_dict[&apos;password&apos;] = args[2]
        else:
            print &apos;args error&apos;
    # 字典类型参数：按{&quot;group_id&quot;:&quot;***&quot;,&quot;user_name&quot;:&quot;***&quot;,&quot;password&quot;:&quot;***&quot;}
    elif kws:
        self.user_dict = kws
    # 对password进行md5处理
    password = self.user_dict.get(&apos;password&apos;)
    if password:
        self.user_dict[&apos;password&apos;] = md5(password)
def login(self, *args):
    if not args:
        base_url = self.base_url
    elif isinstance(args[0], Env):
        base_url = args[0].base_url
    else:
        print &quot;args error&quot;
        return -1
    uri = base_url + &quot;/api/Login/Login/login/&quot;
    data = &apos;req=&apos; + json.dumps(self.user_dict)
    res = self.session.post(uri, data=data, headers=self.headers)
    # print res.text
def post(self, *args):
    &apos;&apos;&apos;发送请求方法,不包含login方法，要在login后使用
    1参：APIFile，使用默认环境,json格式，暂时不支持兼容.config格式的数据
    2参：env对象和APIFile
    2参，base_url和APIFile，base_url如：http://w-beta-1000.chemanman.com:7501
    2参：APIFile和DataFile
    3参：env对象APIFile,DataFile
    注：APIFile还有接口地址和所有必要字段，DataFile，含有多组数据，可以只包含部分变化字段
    &apos;&apos;&apos;
    if len(args) == 1:
        base_url = self.base_url
        api_dict = get_api(args[0])
    elif len(args) == 2:
        if isinstance(args[0], Env):
            base_url = args[0].base_url
            api_dict = get_api(args[1])
        elif &quot;http&quot; in args[0]:
            base_url = args[0]
            api_dict = get_api(args[1])
        else:
            base_url = self.base_url
            api_dict = get_api[args[0]]
    else:
        print &quot;args error&quot;
        return -1
    uri = base_url + api_dict.get(&quot;uri&quot;)
    data = &apos;req=&apos; + json.dumps(api_dict.get(&quot;req&quot;))
    # 尚未对data_file进行替换处理
    res = self.session.post(uri, data=data, headers=self.headers)
    print res.text
def posts(self, full_url, data):
    &apos;&apos;&apos;根据接口地址和数据发送post请求
    full_url:如http://w-beta-1000.chemanman.com:7501/api/Login/Login/login/
    data：支持req={},&quot;req&quot;:{}或{}，3种格式
    &apos;&apos;&apos;
    if isinstance(data, dict):
        if &quot;req&quot; in data.keys():
            data = &quot;req=&quot; + json.dumps(data.get(&quot;req&quot;))
        else:
            data = &quot;req=&quot; + json.dumps(data)
    res = self.session.post(full_url, data=data, headers=self.headers)
    print res.text
def post_all(self, path=&apos;.&apos;):
    &apos;&apos;&apos;发送API文件或子文件夹下的所有json文件&apos;&apos;&apos;
    pass
def list(self):
    pass
def clean(self):
    pass
def pre_data(self):
    pass
def system_set(self):
    pass
def retry(self):
    pass
</code></pre><p>class Env:<br>    ‘’’环境对象，支持：<br>    0参：登录env.conf中的default环境<br>    1参：env.conf中的选项,不允许包含http<br>    1参：完整url,带端口号，如”<a href="http://w-beta-1000.chemanman.com:7501&quot;,结尾不包含/,必须包含http" target="_blank" rel="noopener">http://w-beta-1000.chemanman.com:7501&quot;,结尾不包含/,必须包含http</a><br>    2参：host,port,如beta-1000,7501,如果只写beta,默认为beta-1000<br>    字典：{“env_name”:hzc_7501,<br>    “base_url”:”<a href="http://w-beta-1000.chemanman.com:7501" target="_blank" rel="noopener">http://w-beta-1000.chemanman.com:7501</a>“;,<br>    “db”:”tms_beta_rw”,<br>    “index”:”tms_beta_test”<br>    }<br>    ‘’’<br>    def <strong>init</strong>(self, <em>args, *</em>kws):  # 改为可变参数<br>        env_name = ‘’<br>        base_url = ‘’<br>        db = ‘’<br>        index = ‘’</p>
<pre><code>    # 0参：登录env.conf中的default环境
    if not args:
        _env = get_env(&quot;default&quot;)
        self.base_url = _env.get(&quot;base_url&quot;)
        self.env_name = _env.get(&quot;env_name&quot;)
        self.db = _env.get(&quot;db&quot;)
        self.index = _env.get(&quot;index&quot;)
        # self.env_name
    elif len(args) == 1:
        if &quot;http&quot; in args[0]:  # 参数为完整url
            self.base_url = args[0]
        else:   # 应加上try
            _env = get_env(args[0])
            self.base_url = _env.get(&quot;base_url&quot;)
            self.env_name = _env.get(&quot;env_name&quot;)
            self.db = _env.get(&quot;db&quot;)
            self.index = _env.get(&quot;index&quot;)
    elif len(args) == 2:   # 2参情况
        if &apos;-&apos; in args[0]:
            self.base_url = &quot;http://w-&quot;; + \
                args[0]+&quot;.chemanman.com:&quot; + args[1]
        else:
            self.base_url = &quot;http://w-&quot;; + \
                args[0]+&quot;-1000.chemanman.com:&quot; + args[1]
def check(self):
    pass
def deploy(self):
    pass
def destroy(self):
    pass
def list(self):
    pass
</code></pre><p>class DB:<br>    db_host = ‘’<br>    db_port = ‘’<br>    db_name = ‘’<br>    db_user = ‘’<br>    db_password = ‘’<br>    db_index = ‘’<br>    tables = []<br>    def get(self, table, key):<br>        pass<br>    def do_sql(self):<br>        pass</p>
<pre><code># def filter(self,table,where):
#   pass
def select(self, key, table, where):
    pass
</code></pre><p>class Case:<br>    case_name = ‘’<br>    def run(self):<br>        pass<br>if <strong>name</strong> == ‘<strong>main</strong>‘:<br>    env1 = Env(“beta”, “7501”)<br>    user = User()<br>    user.login(env1)<br>    user.post(‘orgOp’)<br>    user.login(env1)<br>    user.post(‘orgOp’)</p>
<h1 id="Util-option-parser-py"><a href="#Util-option-parser-py" class="headerlink" title="Util/option_parser.py"></a>Util/option_parser.py</h1><p>from optparse import OptionParser</p>
<p>parser = OptionParser(usage=”usage:%prog [optinos] filepath”)<br>parser.add_option(“-a”, “–api”,<br>                action = “store”,<br>                type = ‘str’,<br>                dest = “api”,<br>                default = None,<br>                help=”Specify annalysis execution time limit”<br>                )<br>parser.add_option(“-u”, “–url”,<br>                action = “store_true”,<br>                dest = “url”,<br>                default = False,<br>                help = “Specify if the target is an URL”<br>                )<br>(options, args) = parser.parse_args()  </p>
<h1 id="if-options-url"><a href="#if-options-url" class="headerlink" title="if options.url:"></a>if options.url:</h1><h1 id="print-args-0"><a href="#print-args-0" class="headerlink" title="print(args[0])"></a>print(args[0])</h1><h1 id="print-options-api"><a href="#print-options-api" class="headerlink" title="print options.api"></a>print options.api</h1><p>#Conf</p>
<h1 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h1><h1 id="API"><a href="#API" class="headerlink" title="API"></a>API</h1><h1 id="Case-base-py"><a href="#Case-base-py" class="headerlink" title="Case/base.py"></a>Case/base.py</h1><h1 id="coding-utf-8-2"><a href="#coding-utf-8-2" class="headerlink" title="coding=utf-8"></a>coding=utf-8</h1><p>import sys<br>sys.path.append(“..”)<br>from Util.models import <em><br>from Util.data_file_parser import </em><br>class Base:<br>    “””用例原型”””<br>    def <strong>init</strong>(self):<br>        env = Env(“<a href="http://w-beta-1000.chemanman.com:7502" target="_blank" rel="noopener">http://w-beta-1000.chemanman.com:7502</a>“;)<br>        user = User()<br>        user.login(env)<br>        user.post(env,”priceOpV2”)<br>a = Base()</p>
<h1 id="Case-create-order-py"><a href="#Case-create-order-py" class="headerlink" title="Case/create_order.py"></a>Case/create_order.py</h1><p>from base import Base<br>from Util.data import JsonFile<br>import json</p>
<h1 id="from-Util-OptionParser-import"><a href="#from-Util-OptionParser-import" class="headerlink" title="from Util.OptionParser import *"></a>from Util.OptionParser import *</h1><p>class CreateOrder(Base):</p>
<pre><code>def create_order(self):
    # print options.api
    # file = &quot;../API/&quot; + options.api + &quot;.json&quot;
    self.post(&apos;../API/create_order.json&apos;)
</code></pre><p>if <strong>name</strong> == ‘<strong>main</strong>‘:<br>    a = CreateOrder()<br>    a.create_order()</p>

					</div>

			  <!-- about -->
			  
		</div>

		<!-- pagination -->
	  

		<div class="comment-section">
  
  


</div>
	</div>

	
		<div class="col-md-3">
			<div id="toc" ></div>
		</div>
	

</div>


		<footer>
			

<p>
  &copy; 2018 <a href="http://yoursite.com"> Han Zhichao </a>
</p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	  </div>

		<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>

		<!-- material design -->
		<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script>
		<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>
		<!-- toc -->
		<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
		<script src="/libs/tocify/jquery.tocify.custom.js"></script>

		<script src="/js/main.js"></script>

	</body>
</html>
